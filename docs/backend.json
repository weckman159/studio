

{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the auto community.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the user entity." },
        "name": { "type": "string", "description": "User's display name." },
        "email": { "type": "string", "description": "User's email address.", "format": "email" },
        "avatar": { "type": "string", "description": "URL of the user's avatar image.", "format": "uri" },
        "bio": { "type": "string", "description": "A short biography or description of the user." },
        "createdAt": { "type": "string", "description": "Timestamp of when the user account was created.", "format": "date-time" }
      },
      "required": ["id", "name", "email", "createdAt"]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a blog post or journal entry related to cars.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the post entity." },
        "userId": { "type": "string", "description": "Reference to User. (Relationship: User 1:N Post)" },
        "title": { "type": "string", "description": "Title of the blog post." },
        "content": { "type": "string", "description": "The main content of the blog post." },
        "images": { "type": "array", "description": "URLs of images associated with the post.", "items": { "type": "string" } },
        "tags": { "type": "array", "description": "Tags associated with the post (e.g., 'tuning', 'repair').", "items": { "type": "string" } },
        "likes": { "type": "number", "description": "Number of likes the post has received." },
        "createdAt": { "type": "string", "description": "Timestamp of when the post was created.", "format": "date-time" }
      },
      "required": ["id", "userId", "title", "content", "createdAt"]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a blog post.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the comment entity." },
        "postId": { "type": "string", "description": "Reference to Post. (Relationship: Post 1:N Comment)" },
        "userId": { "type": "string", "description": "Reference to User. (Relationship: User 1:N Comment)" },
        "text": { "type": "string", "description": "The text content of the comment." },
        "createdAt": { "type": "string", "description": "Timestamp of when the comment was created.", "format": "date-time" }
      },
      "required": ["id", "postId", "userId", "text", "createdAt"]
    },
    "Car": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Car",
      "type": "object",
      "description": "Represents a car owned by a user.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the car entity." },
        "userId": { "type": "string", "description": "Reference to User. (Relationship: User 1:N Car)" },
        "brand": { "type": "string", "description": "The brand of the car (e.g., BMW, Audi)." },
        "model": { "type": "string", "description": "The model of the car (e.g., X5, A4)." },
        "year": { "type": "number", "description": "The year the car was manufactured." },
        "engine": { "type": "string", "description": "The engine specification of the car." },
        "photo": { "type": "string", "description": "URL of the car's photo.", "format": "uri" }
      },
      "required": ["id", "userId", "brand", "model", "year", "engine"]
    },
    "FeaturedCar": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FeaturedCar",
      "type": "object",
      "description": "Represents the 'Car of the Day'.",
      "properties": {
        "date": { "type": "string", "description": "The date for which this car is featured (YYYY-MM-DD)." },
        "carId": { "type": "string", "description": "Reference to Car. (Relationship: Car 1:N FeaturedCar)" },
        "userId": { "type": "string", "description": "Reference to User who owns the featured car." }
      },
      "required": ["date", "carId", "userId"]
    },
     "PostLike": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PostLike",
      "type": "object",
      "description": "Represents a user's 'like' on a post. Used to ensure a user can only like a post once.",
      "properties": {
        "userId": { "type": "string", "description": "The ID of the user who liked the post." },
        "postId": { "type": "string", "description": "The ID of the post that was liked." },
        "createdAt": { "type": "string", "description": "Timestamp of when the like was created.", "format": "date-time" }
      },
      "required": ["userId", "postId", "createdAt"]
    },
    "UserSubscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserSubscription",
      "type": "object",
      "description": "Represents a subscription from one user (follower) to another (followed).",
      "properties": {
        "followerId": { "type": "string", "description": "The user who is subscribing." },
        "followedId": { "type": "string", "description": "The user who is being subscribed to." },
        "createdAt": { "type": "string", "description": "Timestamp of the subscription.", "format": "date-time" }
      },
      "required": ["followerId", "followedId", "createdAt"]
    },
    "UserFavorite": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserFavorite",
      "type": "object",
      "description": "Represents a user's favorited post.",
      "properties": {
        "userId": { "type": "string", "description": "The user who favorited the post." },
        "postId": { "type": "string", "description": "The post that was favorited." },
        "createdAt": { "type": "string", "description": "Timestamp of when the post was favorited.", "format": "date-time" }
      },
      "required": ["userId", "postId", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores user profiles. Includes fields like name, email, avatar, and bio.",
          "params": [{ "name": "userId", "description": "The unique identifier for the user." }]
        }
      },
      {
        "path": "/users/{userId}/cars/{carId}",
        "definition": {
          "entityName": "Car",
          "schema": { "$ref": "#/backend/entities/Car" },
          "description": "Stores car information owned by users. Path-based ownership enforced.",
          "params": [
            { "name": "userId", "description": "The unique identifier for the user." },
            { "name": "carId", "description": "The unique identifier for the car." }
          ]
        }
      },
       {
        "path": "/users/{userId}/favorites/{postId}",
        "definition": {
          "entityName": "UserFavorite",
          "schema": { "$ref": "#/backend/entities/UserFavorite" },
          "description": "Stores a user's favorite posts. Path-based ownership enforced.",
          "params": [
            { "name": "userId", "description": "The user who favorited the post." },
            { "name": "postId", "description": "The favorited post's ID." }
          ]
        }
      },
      {
        "path": "/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": { "$ref": "#/backend/entities/Post" },
          "description": "Stores posts. Includes the denormalized `userId`.",
          "params": [{ "name": "postId", "description": "The unique identifier for the post." }]
        }
      },
       {
        "path": "/posts/{postId}/likes/{userId}",
        "definition": {
          "entityName": "PostLike",
          "schema": { "$ref": "#/backend/entities/PostLike" },
          "description": "Tracks likes on a post. The document ID is the user ID.",
          "params": [
            { "name": "postId", "description": "The post being liked." },
            { "name": "userId", "description": "The user who liked the post." }
          ]
        }
      },
      {
        "path": "/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": { "$ref": "#/backend/entities/Comment" },
          "description": "Stores comments. Includes denormalized `postId` and `userId`.",
          "params": [{ "name": "commentId", "description": "The unique identifier for the comment." }]
        }
      },
      {
        "path": "/featured_cars/{date}",
        "definition": {
          "entityName": "FeaturedCar",
          "schema": { "$ref": "#/backend/entities/FeaturedCar" },
          "description": "Stores the 'Car of the Day', with fields for `carId` and `userId`.",
          "params": [{ "name": "date", "description": "The date for which this car is featured (YYYY-MM-DD)." }]
        }
      },
       {
        "path": "/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "UserSubscription",
          "schema": { "$ref": "#/backend/entities/UserSubscription" },
          "description": "Stores user subscription relationships (follower/followed).",
          "params": [{ "name": "subscriptionId", "description": "The unique ID for the subscription document." }]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the AutoSphere application, focusing on posts, user garages, car profiles, and a featured 'Car of the Day'. It prioritizes authorization independence by storing ownership information directly within documents, avoiding the need for complex `get()` calls in security rules. Segregation ensures each collection has a consistent security posture. The structure uses path-based ownership for user-owned data and membership maps where collaboration is required.\\n\\n*   `/users/{userId}`: Stores user profiles. Path-based ownership is used, making security rules straightforward.\\n*   `/users/{userId}/cars/{carId}`: Stores car information owned by users. This hierarchical structure simplifies ownership-based access control.\\n*   `/users/{userId}/favorites/{postId}`: Stores a user's favorited posts. The path ensures a user can only manage their own favorites list.\\n*   `/posts/{postId}`: Stores posts. The `userId` field within each document enables filtering posts by owner.\\n*   `/posts/{postId}/likes/{userId}`: A subcollection to manage post likes. Using the `userId` as the document ID provides an idempotent way to handle likes and prevents duplicates.\\n*   `/comments/{commentId}`:  Stores comments. The `postId` and `userId` enable filtering and associating comments with posts and users.\\n*   `/featured_cars/{date}`: Stores the 'Car of the Day', with fields for `carId` and `userId` to link back to the car and its owner.\\n*   `/subscriptions/{subscriptionId}`: A top-level collection to manage user-to-user subscriptions. Each document contains `followerId` and `followedId` to represent the relationship, allowing for efficient querying of both followers and followed users.\\n\\nThis design achieves authorization independence through denormalization by including the `userId` in the `posts` and `comments` collections. The structure also supports the required QAPs. The segregation of data into separate collections ensures that `list` operations can be secured appropriately."
  }
}
