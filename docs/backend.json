{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the auto community.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "name": {
          "type": "string",
          "description": "User's display name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "avatar": {
          "type": "string",
          "description": "URL of the user's avatar image.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "createdAt"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a blog post or journal entry related to cars.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Post)"
        },
        "title": {
          "type": "string",
          "description": "Title of the blog post."
        },
        "content": {
          "type": "string",
          "description": "The main content of the blog post."
        },
        "images": {
          "type": "array",
          "description": "URLs of images associated with the post.",
          "items": {
            "type": "string"
          }
        },
        "tags": {
          "type": "array",
          "description": "Tags associated with the post (e.g., 'tuning', 'repair').",
          "items": {
            "type": "string"
          }
        },
        "likes": {
          "type": "number",
          "description": "Number of likes the post has received."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "content",
        "createdAt"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a blog post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the comment entity."
        },
        "postId": {
          "type": "string",
          "description": "Reference to Post. (Relationship: Post 1:N Comment)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Comment)"
        },
        "text": {
          "type": "string",
          "description": "The text content of the comment."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the comment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "postId",
        "userId",
        "text",
        "createdAt"
      ]
    },
    "Car": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Car",
      "type": "object",
      "description": "Represents a car owned by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the car entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Car)"
        },
        "brand": {
          "type": "string",
          "description": "The brand of the car (e.g., BMW, Audi)."
        },
        "model": {
          "type": "string",
          "description": "The model of the car (e.g., X5, A4)."
        },
        "year": {
          "type": "number",
          "description": "The year the car was manufactured."
        },
        "photo": {
          "type": "string",
          "description": "URL of the car's photo.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "brand",
        "model",
        "year"
      ]
    },
    "FeaturedCar": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FeaturedCar",
      "type": "object",
      "description": "Represents the 'Car of the Day'.",
      "properties": {
        "date": {
          "type": "string",
          "description": "The date for which this car is featured (YYYY-MM-DD)."
        },
        "carId": {
          "type": "string",
          "description": "Reference to Car. (Relationship: Car 1:N FeaturedCar)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who owns the featured car."
        }
      },
      "required": [
        "date",
        "carId",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Includes fields like name, email, avatar, and bio.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cars/{carId}",
        "definition": {
          "entityName": "Car",
          "schema": {
            "$ref": "#/backend/entities/Car"
          },
          "description": "Stores car information owned by users. Path-based ownership enforced. Includes brand, model, year, and photo.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "carId",
              "description": "The unique identifier for the car."
            }
          ]
        }
      },
      {
        "path": "/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores posts. Includes the denormalized `userId` to allow posts listing for each user. Contains title, content, images, tags, and likes.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments. Includes the denormalized `postId` and `userId`. Contains the comment text.",
          "params": [
            {
              "name": "commentId",
              "description": "The unique identifier for the comment."
            }
          ]
        }
      },
      {
        "path": "/featured_cars/{date}",
        "definition": {
          "entityName": "FeaturedCar",
          "schema": {
            "$ref": "#/backend/entities/FeaturedCar"
          },
          "description": "Stores the 'Car of the Day', with fields for `carId` and `userId` to link back to the car and its owner.",
          "params": [
            {
              "name": "date",
              "description": "The date for which this car is featured (YYYY-MM-DD)."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the AutoSphere application, focusing on posts, user garages, car profiles, and a featured 'Car of the Day'. It prioritizes authorization independence by storing ownership information directly within documents, avoiding the need for complex `get()` calls in security rules. Segregation ensures each collection has a consistent security posture. The structure uses path-based ownership for user-owned data and membership maps where collaboration is required.\n\n*   `/users/{userId}`: Stores user profiles. Path-based ownership is used, making security rules straightforward.\n*   `/users/{userId}/cars/{carId}`: Stores car information owned by users. This hierarchical structure simplifies ownership-based access control.\n*   `/posts/{postId}`: Stores posts. The `userId` field within each document enables filtering posts by owner.\n*   `/comments/{commentId}`:  Stores comments. The `postId` and `userId` enable filtering and associating comments with posts and users.\n*   `/featured_cars/{date}`: Stores the 'Car of the Day', with fields for `carId` and `userId` to link back to the car and its owner.\n\nThis design achieves authorization independence through denormalization by including the `userId` in the `posts`, `comments` and `featured_cars` collections.\n\nThe structure also supports the required QAPs. The segregation of data into separate collections (`users`, `posts`, `cars`, `comments`, `featured_cars`) ensures that `list` operations can be secured appropriately. Path-based ownership ensures that listing cars for a specific user is secure and efficient. The inclusion of `userId` within the `posts` and `comments` collections also means list operations can be constrained and secured based on user identity."
  }
}